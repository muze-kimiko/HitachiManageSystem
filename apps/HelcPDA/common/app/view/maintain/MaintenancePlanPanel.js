/*
 * File: app/view/MaintenancePlanPanel.js
 *
 * This file was generated by Sencha Architect version 3.0.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.3.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.3.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('HelcPDA.view.maintain.MaintenancePlanPanel', {
    extend: 'Ext.Panel',
    //2014-4-1 xcx
    id:'Maintainlist',
    requires: [
        'Ext.Toolbar',
        'Ext.Button',
        'Ext.Spacer',
        'Ext.Label',
        'Ext.dataview.List',
        'Ext.XTemplate'
    ],

    config: {
        items: [
            {
                xtype: 'toolbar',
                docked: 'top',
                title: '保养计划',
                items: [
                    {
                        xtype: 'button',
                        id:'HomePageButton',
                        ui: 'back',
                        text: '主页'
                    },
                    {
                        xtype: 'spacer'
                    },
//                    {
//                        xtype: 'spacer'
//                    },
//                    {
//                        xtype: 'label',
//                        html: '保养计划'
//                    },
//                    {
//                        xtype: 'spacer'
//                    },
                    {
                    	//用于存放 MP_ID
                    	xtype:'hiddenfield',
                    	id:'hidden2MP_ID',
                    },
        			{
                    	//用于存放 fields
        				xtype:'hiddenfield',
        				id:'hidden2fields',
        				value:'mainfields'
        			},
        			{
                    	//用于存放 false或true,表示是否站长  2014-4-14 xcx
        				xtype:'hiddenfield',
        				id:'hiddenZZ',
        				
        			},
        			{
                    	//存放mainfields的数据，用于重置按钮
        				xtype:'hiddenfield',
        				id:'MainPlan_MAINFIELD_CZ',
        				
        			},
        			{
                    	//存放MAINITEM的数据，用于重置按钮
        				xtype:'hiddenfield',
        				id:'MainPlan_MAINMAINITEM_CZ',
        				
        			},
        			{
                    	//存放全局变量MppmYear   年
        				xtype:'hiddenfield',
        				id:'MppmYear',
        				
        			},
        			{
                    	//存放全局变量MppnMonth  月
        				xtype:'hiddenfield',
        				id:'MppnMonth',
        				
        			},
        			{
                    	//存放全局变量MainRL_XuanZhongXB 用于显示日历中的日期
        				//当我单击MPPDateButton按钮时，更具下标刷新日历列表
        				xtype:'hiddenfield',
        				id:'MainRL_XuanZhongXB',
        				
        			},
        			{
        				//查询年-月-日 例子：2014-1-5
        				xtype:'hiddenfield',
        				id:'MaintainAloneTime',
        				
        			},
        			{
        				//不变的当天时间
        				xtype:'hiddenfield',
        				id:'bbtime',
        				
        			},
        			{
        				//日滨返回时用，记录下标
        				xtype:'hiddenfield',
        				id:'listIndex',
        			},
        			{
        				xtype: 'button',
        				id: 'MPPupdate',
        				text: '更新',
        			},
        			{
                        xtype: 'button',
                        handler: function(button, e) {
                            var menu = Ext.create('Ext.Menu', {
                                items: [
//                                {
//                                	id:'MPPupdate',
//                                    text: '更新',
//                                    handler:function(button,e){
//                                   	 Ext.Viewport.hideMenu('right');
//                                   }
//                                },
                                {
                                    text: '签到',
                                    id:'MPP_QD',
                                    handler:function(button,e){
                                      	 Ext.Viewport.hideMenu('right');
                                     }
                                },{
                                	xtype:'button',
                                	text:'站长',
                                	id:'MPPstation',
                                	handler:function(button,e){
                                      	 Ext.Viewport.hideMenu('right');
                                    }
                                },{
                                	xtype:'button',
                                	text:'整月',
                                	id:'MPP_WholeMonth',
                                	handler:function(button,e){
                                      	 Ext.Viewport.hideMenu('right');
                                      }
                                }
                                ]
                            });

                            Ext.Viewport.setMenu(menu, {
                                side: 'right',
                                reveal: false
                            });

                            Ext.Viewport.showMenu('right');

                        },
                        itemId: 'mybutton5',
//                        iconCls: 'more',
                        text: '更多',
                        listeners: {
                        	tap:function() {
                        		//判断是否站长
                        		var zz='*#站长#*,*#片长#*,*#站信息管理员#*';
                        		if(zz.indexOf(position_type) >= 0 )   
                        		{   
                        		   // console.log('站长登录');
                        		   // var aa='dfd';
                        		   // Ext.getCmp('hiddenZZ').setValue(aa);
                        		}else{
                        			console.log(position_type+'登录');
                        			 //Ext.getCmp('hiddenZZ').setValue('no');
                        			 //销毁站长按钮
                        			 var anzz=Ext.getCmp('MPPstation');
                        			 anzz.destroy();
                        		};
                        		
                        	}
                        }
                        
                    }
                ]
            },
            {
                xtype: 'toolbar',
                docked: 'top',
                items: [
                    {
                        xtype: 'button',
                        id:'MppLeftButton',
                        iconCls: 'arrow_left',
                        text: ''
                    },
                   /* {
                        xtype: 'label',
                        id:'labelTime',
                        html: ''
                    },*/
                    {
                    	   xtype: 'button',
                           id:'MPPDateButton',
                           text: ''
                    },
                    {
                        xtype: 'button',
                        id:'MppRightButton',
                        iconCls: 'arrow_right',
                        text: ''
                    },
                    {
                        xtype: 'spacer'
                    },
                   /* {
                        xtype: 'button',
                        id:'MPPDateButton',
                        handler: function(button, e) {
                           // Ext.Viewport.setActiveItem(Ext.create('HelcPDA.view.maintain.MaintenancePlanPanelMonth'));
                        },
                        iconCls: 'search',
                        text: '日历'
                    }*/
                ]
            },
            {
                xtype: 'list',
                //获得仓库 2014-4-1
                store:'MaintainPlanList',
                height: '100%',
                itemId: 'mylist6',
                itemTpl: [
                    '<table border=0 width=100%>',
                    '    <tr height=24>',
                    '        <td colspan=2>',
                    '            <span style="font-size:20px;">{HHMMTime}</span>',
                    '            <span style="margin-left:4px;">{ASSET_NUM}</span>',
                    '            <input type="hidden" name="MP_IDname" value="{MP_ID}"> ',
                    '        </td>',
                    '    </tr>',
                    '    <tr height=24>',
                    '        <td width=50%>{DOMAIN_NAME}</td>',
                    '        <td align=right></td>',
                    '    </tr>',
                    '    <tr height=24>',
                    '        <td width=50%>{PLAN_EMP_IDS}</td>',
                    '        <td align=right>{TASK_NAME}</td>',
//                    '    </tr>',
//                    '    <tr height=24>',
//                    '        <td width=50%><span  class="{BYCSS}">{PLAN_STATUS}</span></td>',
//                    '        <td align=right><img id="intoESS" style="width:22px;" src="images/icon_wifi-router_gold.png"/></td>',
//                    '    </tr>',
                    '    <tr height=24>',
                    '        <td colspan=2>',
                    '           <span  class="{BYCSS}">{PLAN_STATUS}</span><span> 最新提交:{PDA_UPD_DATE}</span>',
                     '           <span  style="float:right;color:red">{ISACTIVE}</span>',
                    '        </td>',
                    '    </tr>',
                  
                    '</table>',
                    '',
                ],
                onItemDisclosure: true,
                
            }
        ]
    },
    
    //初始化
    initialize:function(){
    	
    	//判断是否站长
		var zz='*#站长#*,*#片长#*,*#站信息管理员#*';
		if(zz.indexOf(position_type) >= 0 )   
		{   
		    console.log('站长登录');
		    Ext.getCmp('hiddenZZ').setValue('yes');
		}else{
			console.log(position_type+'登录');
			 Ext.getCmp('hiddenZZ').setValue('no');
			 
		};
		
               //zhj 
		        var getresult=function(res){
		        	var data=res.content;
		        	console.log("ressss",data);	        
		        	//var query={formwork_type:'fullyear,repair'};
		        	var query={remark:'y'};
		        	var options={exact:true};
		        	WL.JSONStore.get(collectionName).remove(query,options).then(function(res){
		        		console.log("成功了！");

			        	var options={};
			        	WL.JSONStore.get(collectionName).add(data,options).then(function (re){
			        		console.log("报告书同步成功！");
			        	}	
			        	).fail(function(err){
			        		 console.log("报告书同步失败！"); 
			        	});
		        	}).fail(function(err){
		        		console.log("失败了！");
		        	});
		        	
		        };
		        MainCtr.asyconnectServer(getresult,"maintainancePlanItemListAction.do?method=toReport","");		    	
		    
		
		
    },
  
    
});

