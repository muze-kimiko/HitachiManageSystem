/*
 * File: app/controller/InstallController.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('HelcRemote.controller.InstallController', {
    extend: 'Ext.app.Controller',

    config: {
        control: {
            "button#Install_Elevator_BtnReturn": {
                tap: 'onInstall_Elevator_BtnReturnTap'
            },
            "button#Install_Contract_BtnReturn": {
                tap: 'onInstall_Contract_BtnReturnTap'
            },
            "button#Install_Branch_BtnReturn": {
                tap: 'onInstall_Branch_BtnReturnTap'
            },
            "button#Install_Region_BtnReturn": {
                tap: 'onInstall_Region_BtnReturnTap'
            },
            "button#Install_chinaMap_BtnReturn": {
                tap: 'onInstall_chinaMap_BtnReturnTap'
            },
            "button#Install_chinaMap_btnHd": {
                tap: 'onInstall_chinaMap_btnHdTap'
            },
            "button#Install_chinaMap_btnHn": {
                tap: 'onInstall_chinaMap_btnHnTap'
            },
            "button#Install_chinaMap_btnHx": {
                tap: 'onInstall_chinaMap_btnHxTap'
            },
            "button#Install_chinaMap_btnHb": {
                tap: 'onInstall_chinaMap_btnHbTap'
            },
            "dataview#Install_Region_Company": {
                itemtap: 'onInstall_Region_CompanyItemTap'
            },
            "dataview#Install_Branch_Projects_List": {
                itemtap: 'onInstall_Branch_Projects_ListItemTap'
            },
            "button#Install_Project_BtnPrev": {
                tap: 'onInstall_Project_BtnPrevTap'
            },
            "button#Install_Project_BtnNext": {
                tap: 'onInstall_Project_BtnNextTap'
            },
            "list#Install_Projects_List": {
                itemtap: 'onInstall_Projects_ListItemTap'
            },
            "button#Install_Project_BtnDetail": {
                tap: 'onInstall_Project_BtnDetailTap'
            },
            "dataview#Install_Elevator_List": {
                itemtap: 'onInstall_Elevator_ListItemTap'
            }
        }
    },

    /* 安装工号 -> 安装合同 */
    onInstall_Elevator_BtnReturnTap: function(button, e, eOpts) {
        viewPath.pop();
        viewUtil.goLast();
    },

    /* 安装合同 -> 分公司 */
    onInstall_Contract_BtnReturnTap: function(button, e, eOpts) {
        viewPath.pop();
        viewUtil.goLast();
    },

    /* 安装 分公司->区域 */
    onInstall_Branch_BtnReturnTap: function(button, e, eOpts) {
        viewPath.pop();
        viewUtil.goLast();
    },

    /* 安装 区域->全国 */
    onInstall_Region_BtnReturnTap: function(button, e, eOpts) {
        viewPath.pop();
        viewUtil.goLast();
    },

    /* 返回售后首屏 */
    onInstall_chinaMap_BtnReturnTap: function(button, e, eOpts) {
        viewPath.pop();
        viewUtil.goLast();
    },

    /* 安装 全国 -> 选中区域 */
    onInstall_chinaMap_btnHdTap: function(button, e, eOpts) {
        this.do_openInstallRegionView(button.getText());
    },

    onInstall_chinaMap_btnHnTap: function(button, e, eOpts) {
        this.do_openInstallRegionView(button.getText());
    },

    onInstall_chinaMap_btnHxTap: function(button, e, eOpts) {
        this.do_openInstallRegionView(button.getText());
    },

    onInstall_chinaMap_btnHbTap: function(button, e, eOpts) {
        this.do_openInstallRegionView(button.getText());
    },

    /* 安装 - 区域 - 选中分公司 */
    onInstall_Region_CompanyItemTap: function(dataview, index, target, record, e, eOpts) {
        var company_code = record.get('company_code');
        var company_name = record.get('sort_name');

        this.company_code = company_code; // 缓存分公司代码

        viewUtil.goNext('Install.branch', {
            onInitial: function() {
                viewPath.push(company_name);
                Ext.getCmp(this.getId() + '_title').setHtml(viewPath.print());
            },
            onShow: function() {
                Ext.getCmp('Install_Branch_Projects_List').getStore().loadDat(
                    function() {},
                    function() {},
                    company_code
                );
                remote.send(this, undefined, company_code);
            }
        });
    },

    /* 安装 - 区域 - 分公司 - 选中合同 */
    onInstall_Branch_Projects_ListItemTap: function(dataview, index, target, record, e, eOpts) {
        var company_code = this.company_code;
        var rec = record;
        var me = this;

        me.seq = index; // 缓存当前记录号

        viewUtil.goNext('Install.contract', {
            onInitial: function() {
                viewPath.push('安装合同');
                Ext.getCmp(this.getId() + '_title').setHtml(viewPath.print());
            },
            onShow: function() {
                var list = Ext.getCmp('Install_Projects_List');
                list.select(me.seq);
                list.scrollToRecord(rec);
                remote.send(this, undefined, company_code);// + '|' + me.seq);
            }
        });
    },

    /* 安装合同页按钮 */
    onInstall_Project_BtnPrevTap: function(button, e, eOpts) {
        //上一项
        var list = Ext.getCmp('Install_Projects_List');
        var sel = list.getSelection();
        //console.log(sel[0].data);
        var seq = sel[0].data.xindex;
        var cnt = sel[0].data.xcount;
        seq = seq - 1;
        if(seq<0) seq = cnt - 1;
        list.select(seq);
        remote.send(button, undefined, seq);
    },

    onInstall_Project_BtnNextTap: function(button, e, eOpts) {
        //下一项
        var list = Ext.getCmp('Install_Projects_List');
        var sel = list.getSelection();
        var seq = sel[0].data.xindex;
        var cnt = sel[0].data.xcount;
        seq = seq + 1;
        if(seq>=cnt) seq = 0;
        list.select(seq);
        remote.send(button, undefined, seq);
    },

    onInstall_Projects_ListItemTap: function(dataview, index, target, record, e, eOpts) {
        //点中一项
        remote.send(dataview, undefined, index);
    },

    onInstall_Project_BtnDetailTap: function(button, e, eOpts) {
        //进入合同明细
        var list = Ext.getCmp('Install_Projects_List');
        var sel = list.getSelection();
        var seq = sel[0].data.xindex;
        var projectNo = sel[0].data.projectNo;

        this.seq = seq; // 当前合同行已被改变

        viewUtil.goNext('Install.elevator', {
            onInitial: function() {
                viewPath.push(projectNo);
                Ext.getCmp(this.getId() + '_title').setHtml(viewPath.print());
            },
            onShow: function() {
                var list = Ext.getCmp('Install_Elevator_List');
                list.getStore().loadDat(
                    function() {},
                    function() {},
                    projectNo
                );
                remote.send(button, undefined, projectNo);
            }
        });
    },

    /* 合同明细页 - 选中一个工号 */
    onInstall_Elevator_ListItemTap: function(dataview, index, target, record, e, eOpts) {
        remote.send(dataview, undefined, index);
    },

    /* 全国 -> 区域公共方法 */
    do_openInstallRegionView: function(region) {
        var regioncode;
        switch(region) {
            case '华东':
                regioncode = 'huadong';
                break;
            case '华南':
                regioncode = 'huanan';
                break;
            case '华西':
                regioncode = 'huaxi';
                break;
            case '华北':
                regioncode = 'huabei';
                break;
        }

        viewUtil.goNext('Install.region', {
            parm: regioncode,
            onInitial: function() {
                viewPath.push(region + '地区');
                Ext.getCmp(this.getId() + '_title').setHtml(viewPath.print());
            },
            onShow: function() {
                Ext.getCmp('Install_Region_Company').getStore().loadDat(
                    function() {},
                    function() {},
                    regioncode
                );
                remote.send(this, undefined, regioncode);
            }
        });
    }

});