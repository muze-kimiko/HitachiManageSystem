/*
 * File: app/controller/LifecycleController.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('HelcRemote.controller.LifecycleController', {
    extend: 'Ext.app.Controller',

    config: {
        control: {
            "list#subNav_Lifecycle": {
                itemtap: 'onSubNav_LifecycleItemTap'
            },
            "dataview#Lifecycle_Company": {
                itemtap: 'onLifecycle_CompanyItemTap'
            },
            "dataview#Lifecycle_Domain": {
                itemtap: 'onLifecycle_DomainItemTap'
            },
            "dataview#Lifecycle_Elevator": {
                itemtap: 'onLifecycle_ElevatorItemTap'
            },
            "dataview#Lifecycle_Elevator_Node": {
                itemtap: 'onLifecycle_Elevator_NodeItemTap'
            },
            "button#Lifecycle_Elevator_btnReturn": {
                tap: 'onLifecycle_Elevator_btnReturnTap'
            },
            "button#lifecycle_BtnConfirmInput": {
                tap: 'onLifecycle_BtnConfirmInputTap'
            },
            "dataview#Lifecycle_Query": {
                itemtap: 'onLifecycle_QueryItemTap'
            }
        }
    },

    /* 生命周期菜单 */
    onSubNav_LifecycleItemTap: function(dataview, index, target, record, e, eOpts) {
        var parent = Ext.getCmp('Lifecycle_subNav');
        var classname;
        var onInitial = Ext.emptyFn();
        var onShow = Ext.emptyFn();

        remote.send(dataview, index);

        var text = record.get('text');
        viewPath.replace(text);
        Ext.getCmp('Lifecycle_subNav_title').setHtml(viewPath.print());
        switch(text) {

            case '东区':
            case '南区':
            case '西区':
            case '北区':
                classname = 'Lifecycle.Select';
                onInitial = function() {
                    Ext.getCmp('Lifecycle_Domain').getStore().setData([]);
                    Ext.getCmp('Lifecycle_Elevator').getStore().setData([]);
                    Ext.getCmp('Lifecycle_Company').getStore().loadDat(
                        function() {},
                        function() {},
                        text
                    );
                };
                break;

            case '搜索工号':
                classname = 'Lifecycle.Input';
                onInitial = function() {
                    Ext.getCmp('Lifecycle_Query').getStore().setData([]);
                };
                break;
        }

        subView.show({classname:classname, parent:parent, onShow:onShow, onInitial:onInitial});
    },

    /* 选中分公司 - 显示楼盘 */
    onLifecycle_CompanyItemTap: function(dataview, index, target, record, e, eOpts) {
        Ext.getCmp('Lifecycle_Elevator').getStore().setData([]);

        var company_code = record.get('company_code');
        Ext.getCmp('Lifecycle_Domain').getStore().loadDat(
            function() {},
            function() {},
            company_code
        );
    },

    /* 选中楼盘 - 显示工号 */
    onLifecycle_DomainItemTap: function(dataview, index, target, record, e, eOpts) {
        var customer_name = record.get('customer_name');
        var domain_name = record.get('domain_name');
        Ext.getCmp('Lifecycle_Elevator').getStore().loadDat(
            function() {},
            function() {},
            {
                domain_name: domain_name,
                customer_name: customer_name
            }
        );
    },

    /* 选中工号 - 进入生命周期 */
    onLifecycle_ElevatorItemTap: function(dataview, index, target, record, e, eOpts) {
        var elevator_code = record.get('elevator_code');
        this.do_OpenLifeCycleDetail(elevator_code);
    },

    /* 选中节点 */
    onLifecycle_Elevator_NodeItemTap: function(dataview, index, target, record, e, eOpts) {
        remote.send(dataview, undefined, index);
    },

    /* 退出生命周期详细 */
    onLifecycle_Elevator_btnReturnTap: function(button, e, eOpts) {
        viewPath.pop();
        viewUtil.goLast();
    },

    /* 搜索工号 */
    onLifecycle_BtnConfirmInputTap: function(button, e, eOpts) {
        var q = Ext.getCmp('lifecycle_q').getValue().trim();
        if(q.length < 4) {
            Ext.toast('查询条件必须为4个字符以上！');
            return;
        }
        Ext.getCmp('Lifecycle_Query').getStore().loadDat(
            function() {},
            function() {},
            q
        );
    },

    /* 选中搜索结果 */
    onLifecycle_QueryItemTap: function(dataview, index, target, record, e, eOpts) {
        var elevator_code = record.get('elevator_code');
        this.do_OpenLifeCycleDetail(elevator_code);
    },

    do_OpenLifeCycleDetail: function(elevator_code) {
        viewUtil.goNext('Lifecycle.ElevatorDetail', {
            onInitial: function() {
                viewPath.push(elevator_code);
                Ext.getCmp(this.getId() + '_title').setHtml(viewPath.print());
            },
            onShow: function() {
                remote.send('Lifecycle_Elevator', undefined, elevator_code);
            }
        });
    }

});