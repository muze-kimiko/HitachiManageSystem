/*
 * File: app/controller/DeviceACController.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('HelcRemote.controller.DeviceACController', {
    extend: 'Ext.app.Controller',

    config: {
        control: {
            "panel#remote_AcMain": {
                initialize: 'onRemote_AcMainInitialize',
                show: 'onRemote_AcMainShow'
            },
            "dataview#nav_indexListAc": {
                itemtap: 'onNav_indexListAcItemTap'
            }
        }
    },

    onRemote_AcMainInitialize: function(component, eOpts) {
        Ext.getCmp('ACFloor1').setItems([
            {
                xtype: 'label',
                docked: 'top',
                html: '一层'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'A01',
                text: '<i class="fa fa-users"></i>&nbsp;&nbsp;参观区',
                style: 'width:80%'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'A02',
                text: '<i class="fa fa-coffee"></i>&nbsp;&nbsp;接待区',
                style: 'width:80%'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'A03',
                text: '<i class="fa fa-street-view"></i>&nbsp;&nbsp;公共区',
                style: 'width:80%'
            },
        ]);

        Ext.getCmp('ACFloor2').setItems([
            {
                xtype: 'label',
                docked: 'top',
                html: '二层'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'C01',
                text: '<i class="fa fa-users"></i>&nbsp;&nbsp;参观区',
                style: 'width:80%'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'C02',
                text: '<i class="fa fa-coffee"></i>&nbsp;&nbsp;接待区',
                style: 'width:80%'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'C03',
                text: '<i class="fa fa-street-view"></i>&nbsp;&nbsp;公共区',
                style: 'width:80%'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'C04',
                text: '<i class="fa fa-pencil"></i>&nbsp;&nbsp;办公区',
                style: 'width:80%'
            },
        ]);

        Ext.getCmp('ACFloor3').setItems([
            {
                xtype: 'label',
                docked: 'top',
                html: '三层'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'B01',
                text: '<i class="fa fa-users"></i>&nbsp;&nbsp;参观区',
                style: 'width:80%'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'B02',
                text: '<i class="fa fa-street-view"></i>&nbsp;&nbsp;公共区',
                style: 'width:80%'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'B03',
                text: '<i class="fa fa-pencil"></i>&nbsp;&nbsp;办公区',
                style: 'width:80%'
            },
        ]);

        Ext.getCmp('ACFloor0').setItems([
            {
                xtype: 'label',
                docked: 'top',
                html: '负一层'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'D01',
                text: '<i class="fa fa-automobile"></i>&nbsp;&nbsp;负一层全部',
                style: 'width:80%',
            },
        ]);

        Ext.getCmp('ACFloorM').setItems([
            {
                xtype: 'label',
                docked: 'top',
                html: '遥监区'
            },
            {
                xtype: 'mybutton',
                deviceType: 'ac',
                id: 'E01',
                text: '<i class="fa fa-tv"></i>&nbsp;&nbsp;遥监区全部',
                style: 'width:80%',
            },
        ]);
    },

    onRemote_AcMainShow: function(component, eOpts) {
        var me = this;
        var justLoopIt = function() {
            var task = Ext.create('Ext.util.DelayedTask', function() {
                me.doRefresh_AC();
                justLoopIt.call(this);
            }, this);

            if(!Ext.getCmp('remote_AcMain')) {
                task.cancel();
            } else {
                task.delay(30000);
            }
        };

        me.doRefresh_AC();
        justLoopIt();
    },

    onNav_indexListAcItemTap: function(dataview, index, target, record, e, eOpts) {
        if(index===0) {
            viewUtil.goLast();
        } else {
            this.doRefresh_AC();
        }
    },

    doRefresh_AC: function() {
        var processQuery = function(ret) {

            var data = ret.status.data || [];
            if(data.constructor !== Array) return;

            var id, st, btn;
            for(var i=0; i<data.length; i++) {
                if(typeof(data[i])!=='string') continue;

                id = data[i].substr(0, 3);
                st = data[i].substr(-1);
                btn = Ext.getCmp(id);
                //console.log(id,st,btn);

                if(!btn) continue;
                if(st==='1') {
                    btn.setOn();
                } else {
                    btn.setOff();
                }
            }
        };

        acRemote.send('AQUERY', processQuery);
        acRemote.send('BQUERY', processQuery);
        acRemote.send('CQUERY', processQuery);
        acRemote.send('DQUERY', processQuery);
        acRemote.send('EQUERY', processQuery);
    }

});