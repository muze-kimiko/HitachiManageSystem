
/* JavaScript content from app/controller/ServiceMainController.js in folder common */
/*
 * File: app/controller/ServiceMainController.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('HelcRemote.controller.ServiceMainController', {
    extend: 'Ext.app.Controller',

    config: {
        control: {
            "list#service_ListNav": {
                itemtap: 'onService_ListNavItemSelect'
            },
            "button#service_BtnMonitor": {
                tap: 'onService_BtnMonitorTap'
            },
            "button#service_BtnInstall": {
                tap: 'onService_BtnInstallTap'
            },
            "button#service_BtnParts": {
                tap: 'onService_BtnPartsTap'
            },
            "button#service_BtnLifecycle": {
                tap: 'onService_BtnLifecycleTap'
            },
            "dataview#service_ChinaMap_DataCity": {
                itemtap: 'onService_ChinaMap_DataCityItemTap'
            },
            "button#service_ChinaMap_BtnHd": {
                tap: 'onService_ChinaMap_BtnHdTap'
            },
            "button#service_ChinaMap_BtnHn": {
                tap: 'onService_ChinaMap_BtnHnTap'
            },
            "button#service_ChinaMap_BtnHx": {
                tap: 'onService_ChinaMap_BtnHxTap'
            },
            "button#service_ChinaMap_BtnHb": {
                tap: 'onService_ChinaMap_BtnHbTap'
            },
            "button#service_News_Stop": {
                tap: 'onService_News_StopTap'
            },
            "button#service_News_LastPage": {
                tap: 'onService_News_LastPageTap'
            },
            "button#service_News_NextPage": {
                tap: 'onService_News_NextPageTap'
            },
            "dataview#service_News_DataNews": {
                select: 'onService_News_DataNewsSelect',
                itemtap: 'onService_News_DataNewsItemTap'
            },
            "button#service_News_Last": {
                tap: 'onService_News_LastTap'
            },
            "button#service_News_Next": {
                tap: 'onService_News_NextTap'
            },
            "button#service_customer_btnStop": {
                tap: 'onService_customer_btnStopTap'
            },
            "button#service_customer_btnLastPage": {
                tap: 'onService_customer_btnLastPageTap'
            },
            "button#service_customer_btnNextPage": {
                tap: 'onService_customer_btnNextPageTap'
            },
            "button#service_demo_btnLast": {
                tap: 'onService_demo_btnLastTap'
            },
            "button#service_demo_btnNext": {
                tap: 'onService_demo_btnNextTap'
            },
            "button#service_demo_btnMonitor": {
                tap: 'onService_demo_btnMonitorTap'
            }
        }
    },

    /* 售后其他功能菜单 */
    onService_ListNavItemSelect: function(dataview, index, target, record, e, eOpts) {
        var parent = Ext.getCmp('Service_subNav');
        var classname;
        var onInitial = Ext.emptyFn();

        remote.send(dataview, index);

        var text = record.get('text');
        switch(text) {
            case '全国地图':
                classname = 'Service.chinaMap';
                onInitial = function() {
                    Ext.getCmp('service_ChinaMap_DataCity').getStore().loadDat(
                        function() {},
                        function() {},
                        null
                    );
                };
                break;

            case '行业新闻':
                classname = 'Service.news';
                onInitial = function() {
                    Ext.getCmp('service_News_DataNews').getStore().loadDat(
                        function() {},
                        function() {},
                        ''
                    );
                };
                break;

            case '合作客户':
                classname = 'Service.customer';
                break;

            case '售后数据':
                break;

            case '故障演示':
                classname = 'Service.demo';
                break;
        }

        subView.show({classname:classname, parent:parent, onInitial:onInitial});
    },

    /* 进入实时监控 */
    onService_BtnMonitorTap: function(button, e, eOpts) {
            viewUtil.goNext('Service.subNav_Monitor', {
                onInitial: function() {
                    viewPath.push('实时监控');
                    viewPath.push('首页');
                }
            });
    },

    /* 售后 -> 安装 跳转 */
    onService_BtnInstallTap: function(button, e, eOpts) {
        viewUtil.goNext('Install.chinaMap', {
            onInitial: function() {
                viewPath.push('安装');
            },
            onShow: function() {
                remote.send(button);
            }
        });
    },

    /* 售后 -> 配件 跳转 */
    onService_BtnPartsTap: function(button, e, eOpts) {
        viewUtil.goNext('Parts.chinaMap', {
            onInitial: function() {
                viewPath.push('配件');
            },
            onShow: function() {
                Ext.getCmp('Parts_chinaMap_title').setHtml(viewPath.print());
                Ext.getCmp('Parts_subNav').select(0);
                remote.send(button);
            }
        });

    },

    /* 售后 -> 生命周期 */
    onService_BtnLifecycleTap: function(button, e, eOpts) {
        viewUtil.goNext('Lifecycle.query', {
            onInitial: function() {
                viewPath.push('生命周期');
                Ext.getCmp(this.getId() + '_title').setHtml(viewPath.print());

                Ext.getCmp('Lifecycle_query_DataSite').getStore().loadDat(
                    function() {},
                    function() {},
                    null
                );
                Ext.getCmp('Lifecycle_query_DataLife').getStore().setData([]);
            },
        });
    },

    /* 显示城市天气 */
    onService_ChinaMap_DataCityItemTap: function(dataview, index, target, record, e, eOpts) {
        var key = Ext.getCmp('service_chinaMap').initialConfig.parm.parent.getId() + '.' + dataview.getId();
        var city = record.get('cityCode');
        remote.send(key, undefined, city);
    },

    /* 全国地图.进入华东画面 */
    onService_ChinaMap_BtnHdTap: function(button, e, eOpts) {
        var text = button.getText();
        HelcRemote.app.getController('ServiceRegionController').doOpenRegionView(text);
    },

    /* 全国地图.进入华南画面 */
    onService_ChinaMap_BtnHnTap: function(button, e, eOpts) {
        var text = button.getText();
        HelcRemote.app.getController('ServiceRegionController').doOpenRegionView(text);
    },

    /* 全国地图.进入华西画面 */
    onService_ChinaMap_BtnHxTap: function(button, e, eOpts) {
        var text = button.getText();
        HelcRemote.app.getController('ServiceRegionController').doOpenRegionView(text);
    },

    /* 全国地图.进入华北画面 */
    onService_ChinaMap_BtnHbTap: function(button, e, eOpts) {
        var text = button.getText();
        HelcRemote.app.getController('ServiceRegionController').doOpenRegionView(text);
    },

    /* 售后.新闻页面 */
    onService_News_StopTap: function(button, e, eOpts) {
        var text = button.getText();
        var index;
        if(text==='停止换屏') {
            text = '继续换屏';
            index = 0;
        } else {
            text = '停止换屏';
            index = 1;
        }
        button.setText(text);
        remote.send(Ext.getCmp('service_news').initialConfig.parm.parent.getId() + '.' + button.getId(), index);
    },

    onService_News_LastPageTap: function(button, e, eOpts) {
        remote.send(Ext.getCmp('service_news').initialConfig.parm.parent.getId() + '.' + button.getId());
    },

    onService_News_NextPageTap: function(button, e, eOpts) {
        remote.send(Ext.getCmp('service_news').initialConfig.parm.parent.getId() + '.' + button.getId());
    },

    onService_News_DataNewsSelect: function(dataview, record, eOpts) {
        Ext.getCmp('service_news_rightpanel').show();

        var key = Ext.getCmp('service_news').initialConfig.parm.parent.getId() + '.' + dataview.getId();
        var index = record.get('xindex');
        remote.send(key, undefined, index);
    },

    onService_News_DataNewsItemTap: function(dataview, index, target, record, e, eOpts) {
        var task = Ext.create('Ext.util.DelayedTask', function() {
                        task.cancel();
                        if(dataview.getSelection().length===0) {
                            Ext.getCmp('service_news_rightpanel').hide();
                            var key = Ext.getCmp('service_news').initialConfig.parm.parent.getId() + '.backToNewsList';
                            remote.send(key);
                            Ext.getCmp('service_News_Stop').setText('停止换屏');
                        }
                    }, this);
        task.delay(200);
    },

    onService_News_LastTap: function(button, e, eOpts) {
        var dv = Ext.getCmp('service_News_DataNews');
        var n = dv.getSelection()[0].getData().xindex;
        dv.select(n===0? 4:n-1);
    },

    onService_News_NextTap: function(button, e, eOpts) {
        var dv = Ext.getCmp('service_News_DataNews');
        var n = dv.getSelection()[0].getData().xindex;
        dv.select(n===4? 0:n+1);
    },

    /* 售后.合作客户 画面 */
    onService_customer_btnStopTap: function(button, e, eOpts) {
        //remote.send(button);

        var text = button.getText();
        var index;
        if(text==='停止换屏') {
            text = '继续换屏';
            index = 0;
        } else {
            text = '停止换屏';
            index = 1;
        }
        button.setText(text);
        remote.send(button, index);
    },

    onService_customer_btnLastPageTap: function(button, e, eOpts) {
        remote.send(button);
    },

    onService_customer_btnNextPageTap: function(button, e, eOpts) {
        remote.send(button);
    },

    /* 故障演示 */
    onService_demo_btnLastTap: function(button, e, eOpts) {
        //上一个故障
        remote.send(button, undefined, '-1');
    },

    onService_demo_btnNextTap: function(button, e, eOpts) {
        //下一个故障
        remote.send(button, undefined, '1');
    },

    onService_demo_btnMonitorTap: function(button, e, eOpts) {
        //进入遥监
        remote.send('#getElevatorCode', undefined, undefined, // 获取大屏上的当前故障工号
                    function(ret) {
                        HelcRemote.app.getController('ServiceElevatorController')
                            .doOpenElevatorDetail(ret.data[0].elevatorcode,ret.data[0].elevatortype);
                    },
                    Ext.emptyFn);
    }

});